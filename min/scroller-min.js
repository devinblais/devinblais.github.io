function Player(t,i){this.canvas=t,this.ctx=t.getContext("2d"),this.image=i,this.x=50,this.y=-100,this.vy=0,this.width=68,this.height=100,this.state="stand",this.gravity=.35}function Game(t,i){this.player=t,this.canvas=i,this.ctx=i.getContext("2d"),this.obstacles=[]}function Rock(t){this.height=30*Math.random()+5,this.width=30*Math.random()+5,this.x=800,this.y=t.height-this.height,this.vx=-5,this.canvas=t,this.ctx=t.getContext("2d")}Player.prototype.spriteOffsets={stand:0,walk:68,jump:136},Player.prototype.draw=function(t){this.vy+=this.gravity,this.y+=this.vy,this.y+this.height>=this.canvas.height&&(this.y=this.canvas.height-this.height,this.vy=0,"jump"===this.state&&(this.state="stand"));var i=this.spriteOffsets[this.state];this.ctx.drawImage(this.image,i,0,this.width,this.height,this.x,this.y,this.width,this.height)},Player.prototype.updateStride=function(t){if("jump"!==this.state){var i=t%300>150;this.state=i?"walk":"stand"}},Player.prototype.jump=function(){"jump"!==this.state&&(this.vy-=7,this.state="jump")},Game.prototype.detectCollision=function(t,i){return function(t,i){var s=t.x,h=t.x+t.width,e=i.x,a=i.x+i.width;return h>e&&h<a||s>e&&s<a}(t,i)&&function(t,i){var s=t.y,h=t.y+t.height,e=i.y,a=i.y+i.height;return s>e&&s<a||h>a&&h<e}(t,i)},Game.prototype.render=function(t){for(var i=0;i<this.obstacles.length;i++)if(this.detectCollision(this.obstacles[i],this.player))return;200*Math.random()<1&&this.obstacles.push(new Rock(canvas));var s=this.lastTimestamp?t-this.lastTimestamp:0;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.player.updateStride(t),this.player.draw(s);for(i=0;i<this.obstacles.length;i++)this.obstacles[i].x<0?this.obstacles[i]=null:this.obstacles[i].render(s);var h=[];for(i=0;i<this.obstacles.length;i++)this.obstacles[i]&&h.push(this.obstacles[i]);this.obstacles=h,window.requestAnimationFrame(this.render.bind(this))},Rock.prototype.render=function(t){this.x+=this.vx,this.ctx.beginPath(),this.ctx.lineWidth=7,this.ctx.rect(this.x,this.y,this.width,this.height),this.ctx.stroke()},window.onload=function(){var t=document.getElementById("canvas"),i=document.createElement("img");i.onload=function(){var s=new Player(t,i),h=new Game(s,t);window.startGame=function(){h.render(),document.onkeydown=function(t){32==t.which&&(t.preventDefault(),s.jump())}}},i.src="./images/walk.png"};